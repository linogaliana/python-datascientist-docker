FROM linogaliana/vscode-python:conda

USER root

# Create the environment:
COPY environment.yml .

RUN conda install mamba -n base -c conda-forge && \
    mamba env create --force -q -n python-ENSAE --file environment.yml

RUN echo ". /opt/conda/etc/profile.d/conda.sh" >> ~/.bashrc && \
    echo "conda activate python-ENSAE" >> ~/.bashrc

RUN conda info --envs

# R packages 
RUN Rscript -e 'devtools::install_github("linogaliana/tablelight", dependencies = TRUE)'

# WRITE RETICULATE_PYTHON VARIABLE IN .Renviron
RUN echo "RETICULATE_PYTHON = '/opt/conda/envs/python-ENSAE/bin/python'" >> /usr/local/lib/R/etc/Renviron

# ENSURE GOOD PYTHON USED BY COMMAND LINE
RUN alias python='/opt/conda/envs/python-ENSAE/bin/python'
RUN echo "alias python='/opt/conda/envs/python-ENSAE/bin/python'" >> ~/.bashrc
ENV PATH="$PATH:/opt/conda/envs/python-ENSAE/bin/python"

RUN opt/conda/envs/python-ENSAE/bin/python -m spacy download en_core_web_sm
RUN opt/conda/envs/python-ENSAE/bin/python -m gensim.downloader --download glove-wiki-gigaword-200

